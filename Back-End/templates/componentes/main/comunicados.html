<link rel="stylesheet" href="/static/css/componentes/main/comunicados.css">
<div class="containerPadreComunicados">
    <div class="containerComunicados">
        <div class="cabecera">
            <h2>COMUNICADOS</h2>
            <a href="/comunicado/agregar"><i class="fa-solid fa-plus"></i></a>
        </div>
        <div class="body">
            <table id="tablaComunicados">
                <thead>
                    <th class="dirigido">Dirigido</th>
                    <th class="curso">Curso</th>
                    <th class="nombre">Nombre</th>
                    <th class="comunicado">Comunicado</th>
                    <th class="fecha">Fecha</th>
                    <th class="hora">Hora</th>
                    <th class="accion">Acción</th>
                </thead>
                <tbody>
                    {% for comunicado in comunicados %}
                    <tr data-id="{{ comunicado.id }}"
                        data-descripcion="{{ comunicado.descripcion }}"
                        data-dirigido="{{ comunicado.dirigido }}"
                        data-idCurso="{{ comunicado.idCurso }}"
                        data-idEmisor="{{ comunicado.idEmisor }}"
                        data-fecha="{{ comunicado.fecha }}"
                        data-hora="{{ comunicado.hora }}">
                        <td>{{ comunicado.dirigido }}</td>
                        <td>
                            {% if comunicado.idCurso == 0 %}
                                Todos
                            {% else %}
                                {% for curso in cursos %}
                                    {% if curso.id == comunicado.idCurso %}
                                        {{ curso.año }} - {{ curso.division }}
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </td>
                        {% for usuario in usuarios %}
                            {% if usuario.id == comunicado.idEmisor %}
                                <td>{{ usuario.nombre }} {{ usuario.apellido }}</td>
                            {% endif %}
                        {% endfor %}
                        <td>{{ comunicado.descripcion }}</td>
                        <td>{{ comunicado.fecha }}</td>
                        <td>{{ comunicado.hora }}</td>
                        <td class="accionTd">
                            <i class="fa-solid fa-eye ver" onclick="abrirModal({{ comunicado.id }})"></i>
                            <button class="fa-solid fa-trash eliminar" onclick="confirmarEliminar({{ comunicado.id }})"></button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div id="modalComunicado" class="modal">
    <div class="modal-contenido">
        <span class="cerrar">&times;</span>
        <h2>Detalles del Comunicado</h2>
        <form id="formModificarComunicado" action="/comunicado/modificar" method="post">
            <input type="hidden" id="modalId" name="id">
            <label for="modalDescripcion">Descripción:</label>
            <textarea id="modalDescripcion" name="descripcion"></textarea>

            <label for="modalDirigido">Dirigido a:</label>
            <select id="modalDirigido" name="dirigido">
                <option value="Padres">Padres</option>
                <option value="Alumnos">Alumnos</option>
                <option value="Profesores">Profesores</option>
                <option value="Preceptores">Preceptores</option>
                <option value="Todos">Todos</option>
            </select>
            <label for="modalIdCurso">Curso:</label>
            <select id="modalIdCurso" name="idCurso">
                {% for curso in cursos %}
                    <option value="{{ curso.id }}">{{ curso.año }} - {{ curso.division }}</option>
                {% endfor %}
            </select>
            <label for="modalIdEmisor">Emisor:</label>
            <select id="modalIdEmisor" name="idEmisor">
                {% for usuario in usuarios %}
                    <option value="{{ usuario.id }}">{{ usuario.nombre }} {{ usuario.apellido }}</option>
                {% endfor %}
            </select>
            <label for="modalFecha">Fecha:</label>
            <input type="text" id="modalFecha" name="fecha" readonly>
            <label for="modalHora">Hora:</label>
            <input type="text" id="modalHora" name="hora" readonly>
            <button type="submit">Modificar</button>
        </form>
    </div>
</div>

<script>
        document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('modalComunicado');
        const span = document.getElementsByClassName('cerrar')[0];

        window.abrirModal = function(id) {
            const row = document.querySelector(`tr[data-id="${id}"]`);
            if (row) {
                document.getElementById('modalId').value = id;
                document.getElementById('modalDescripcion').value = row.dataset.descripcion;
                document.getElementById('modalDirigido').value = row.dataset.dirigido;
                document.getElementById('modalIdCurso').value = row.dataset.idcurso;
                document.getElementById('modalIdEmisor').value = row.dataset.idemisor;
                document.getElementById('modalFecha').value = row.dataset.fecha;
                document.getElementById('modalHora').value = row.dataset.hora;
                modal.style.display = 'block';
            }
        };
        window.confirmarEliminar = function(id) {
            if (confirm('¿Estás seguro de que quieres eliminar este comunicado?')) {
                window.location.href = `/comunicado/eliminar/${id}`;
            }
        };

        span.onclick = function() {
            modal.style.display = 'none';
        };

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        };
    });
</script>
