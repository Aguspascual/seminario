<link rel="stylesheet" href="/static/css/componentes/aside/calendario.css">
<div class="contenedorCalendarioAside">
    <h3>Calendario:</h3>
    <div class="box">
        <h5 id="mesTituloAside"></h5>
        <div class="grilla" id="calendarioGrillaAside">
            <div class="dia">L</div>
            <div class="dia">M</div>
            <div class="dia">M</div>
            <div class="dia">J</div>
            <div class="dia">V</div>
            <div class="dia">S</div>
            <div class="dia">D</div>
        </div>
    </div>
</div>

<div id="modalEventosDiaAside" class="modal">
    <div class="modal-contenido">
        <span class="cerrar">&times;</span>
        <h2 id="fechaSeleccionadaAside"></h2>
        <ul id="listaEventosDiaAside"></ul>
    </div>
</div>

<script>
    const calendarioGrillaAside = document.getElementById('calendarioGrillaAside');
    const mesTituloAside = document.getElementById('mesTituloAside');
    const modalEventosDiaAside = document.getElementById('modalEventosDiaAside');
    const fechaSeleccionadaAside = document.getElementById('fechaSeleccionadaAside');
    const listaEventosDiaAside = document.getElementById('listaEventosDiaAside');
    const cerrarModalAside = document.querySelector('#modalEventosDiaAside .cerrar');

    let anioActualAside = new Date().getFullYear();
    let mesActualAside = new Date().getMonth() + 1;

    function obtenerDiasMesAside(anio, mes) {
        return new Date(anio, mes, 0).getDate();
    }

    function actualizarCalendarioAside(anio, mes) {
        const primerDiaMes = new Date(anio, mes - 1, 1).getDay();
        const diasMes = obtenerDiasMesAside(anio, mes);
        calendarioGrillaAside.innerHTML = '<div class="dia">L</div><div class="dia">M</div><div class="dia">M</div><div class="dia">J</div><div class="dia">V</div><div class="dia">S</div><div class="dia">D</div>';
        for (let i = 0; i < primerDiaMes - (primerDiaMes === 0 ? -6 : 1); i++) {
            calendarioGrillaAside.innerHTML += '<div></div>';
        }
        for (let i = 1; i <= diasMes; i++) {
            const fecha = `${anio}-${mes.toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
            calendarioGrillaAside.innerHTML += `<div class="numero" data-fecha="${fecha}">${i}</div>`;
        }
        mesTituloAside.textContent = new Date(anio, mes - 1).toLocaleString('default', { month: 'long' }).toUpperCase();

        // Obtener eventos del mes y marcar los días con eventos
        const calendarioAside = {{ calendarioAside | tojson | safe }};

        calendarioAside.forEach(evento => {
            const diaConEvento = calendarioGrillaAside.querySelector(`[data-fecha="${evento.fecha}"]`);
            if (diaConEvento) {
                if (evento.eventos && evento.eventos.length > 0) {
                    diaConEvento.classList.add('agendada');
                    diaConEvento.addEventListener('click', () => {
                        fechaSeleccionadaAside.textContent = evento.fecha;
                        listaEventosDiaAside.innerHTML = '';
                        evento.eventos.forEach(ev => {
                            const li = document.createElement('li');
                            li.textContent = `${ev.hora} - ${ev.evento} (Curso: ${ev.curso})`; // Modificação aqui
                            listaEventosDiaAside.appendChild(li);
                        });
                        modalEventosDiaAside.style.display = 'block';
                    });
                } else {
                    diaConEvento.addEventListener('click', () => {
                        fechaSeleccionadaAside.textContent = evento.fecha;
                        listaEventosDiaAside.innerHTML = '<li>Não há eventos para este dia.</li>';
                        modalEventosDiaAside.style.display = 'block';
                    });
                }
            }
        });
    }

    cerrarModalAside.addEventListener('click', () => {
        modalEventosDiaAside.style.display = 'none';
    });

    window.addEventListener('click', (event) => {
        if (event.target === modalEventosDiaAside) {
            modalEventosDiaAside.style.display = 'none';
        }
    });

    actualizarCalendarioAside(anioActualAside, mesActualAside);
</script>